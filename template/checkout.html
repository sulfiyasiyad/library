{% extends 'navfour.html' %}
{% block content %}
{% load static %}

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert {% if message.tags %}alert-{{ message.tags }}"{% endif %}>
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}
<div class="container mt-3">
    <form action="{% url 'placeorder' %}" method="post"  onsubmit="return validateForm()">
        {% csrf_token %}
    <div class="row">
        <div class="col-md-7">
            <div class="card shadow">
                <div class="card">
                    <div class="card-body">
                        <h6>Basic Details</h6>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <label>First Name</label>
                                <input type="text" class="form-control" placeholder="Enter the First name" value="{{request.user.first_name}}" name="n1" required>
                            </div>
                            <div class="col-md-6">
                                <label>Last Name</label>
                                <input type="text" class="form-control" placeholder="Enter the Last name" value="{{request.user.last_name}}" name="n2" required>

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>Email</label>
                                <input type="email" class="form-control" placeholder="Enter the Email" value="{{request.user.email}}" name="n3" id="email" required>

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>Phone</label>
                                <input type="tel" class="form-control"  name="n5"  required value="{{usermember1.number}}"  required pattern="[1-9]{1}[0-9]{9}" title="password must contain 10 digit">

                            </div>
                            <div class="col-md-12">
                                <label>Address</label>
                                <textarea class="form-control" placeholder="Enter the Address" name="n4"  required></textarea>

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>Country</label>
                                <input type="text" class="form-control" placeholder="Enter the Country " name="n8" required >

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>State</label>
                                <input type="text" class="form-control" placeholder="Enter the State" name="n7" required>

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>City</label>
                                <input type="text" class="form-control" placeholder="Enter the City" name="n6" required>

                            </div>
                            <div class="col-md-6 mt-2">
                                <label>Pincode</label>
                                <input type="text" class="form-control" placeholder="Enter the pincode" name="n11" required>

                            </div>
                        </div>



                    </div>

            
    
                </div>
            
    
            </div>

    
        </div>
        <div class="col-md-5">
            <div class="card shadow">
                <div class="card-body">
                    <h6>Order summary</h6>
                    <hr>
                    {% if cartitems %}
                        <table class="table table-striped  table-bordereds">
                            <thead>
                                <tr>
                                    <th>name</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in cartitems %}
                                <tr>
                                    <td><img src="{{item.book.Image.url}}" height="50px" class="me-2" width="50px">
                                    {{item.book.book_name}}</td>
                                    <td>{{item.quantity}}</td>
                                    <td>{{item.book.book_price}}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <h6 class="fw-bold">Grand Total
                            <span class="float-right">Rs:{{total_price}}</span>
                        </h6>
                        <input type="hidden" value="COD" name="n10">
                        
                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary w-100">COD|Place Order</button><br><br>
                            <button type="submit" class="btn btn-primary w-100 razropay">Razropay</button>
                        </div>
                    {% else %}
                   
                    <h4> Your cart is empty</h4>
                    {% endif %}
                </div>
            </div>
        </div>

    
         
    
    </div>
    </form>


</div> 
<script>
     function validateForm() {
    var emailInput = document.getElementById('email').value;
   
    if (!emailInput.endsWith('gmail.com')) {
      alert('Please enter a valid email address ending with "gmail.com".');
      return false; // Prevent form submission
    }
    return true; // Allow form submission
  }
  
</script>
{% block scripts %}










<!-- <script>
    $(document).ready(function(){
    $('.razropay').click(function(e){
        e.preventDefault();
        var fname= $("[name = 'n1']").val();
        var lname= $("[name = 'n2']").val();
        var email= $("[name = 'n3']").val();
        var address= $("[name = 'n4']").val();
        var phone= $("[name = 'n5']").val();
        var city= $("[name = 'n6']").val();
        var state= $("[name = 'n7']").val();
        var country= $("[name = 'n8']").val();
        var pincode= $("[name = 'n11']").val();
        var token=$("[name='csrfmiddlewaretoken']").val();
        if( fname == ""|| lname == ""|| email == "" || address == "" || phone == "" || city == ""|| state == "" || country ==""|| pincode == "")
        {
            swal("Alert","all fields are mandatory","error");
            return false;
        }
        else{ -->
                <!-- // $.ajax({
                //     method: "GET",
                //     url:"checkout",    
                //     success: function(response){
                //         console.log(response);                      
                //     }
                // }); -->
             <!-- var options = {
                "key": "rzp_test_egDk3TA76JJFTG", // Enter the Key ID generated from the Dashboard
                "amount": "{{total_price}}"*100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "sulfiya", //your business name
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                // "order_id": "order_9A33XWu170gUtm", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response){




                    alert(response.razorpay_payment_id);
                    // alert(response.razorpay_order_id);
                    // alert(response.razorpay_signature)
                    data={
                        'fname':fname,
                        'lname':lname,
                        'email':email,
                        'address':address,
                        'phone':phone,
                        'city':city,
                        'state':state,
                        'country':country, 
                        'pincode':pincode,
                        'payment_mode':"paid by razropay",
                        'payment_id':response.razorpay_payment_id,
                        csrfmiddlewaretoken:token
                       
                    }
                      $.ajax({
                        method: "POST",
                        url:"/placeorder", 
                        data:data,   
                        success: function(response){
                            swal("congragulaions",response.status,"sucess").then((value) => {
                            window.location.href="/my_orders"
                        });
                            swal(response.status)
                                                  
                        }
                    });
                    



                },
                "prefill": { //We recommend using the prefill parameter to auto-fill customer's contact information, especially their phone number
                    "name": fname, //your customer's name
                    "email": email, 
                    "contact": phone  //Provide the customer's phone number for better conversion rates 
                },
                
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                    
                    
                    alert(response.error.metadata.payment_id);
            });
        
            
                rzp1.open();
        }
    })
})




</script> -->







<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

{% endblock scripts %}

{% endblock %}










